<!-- The draggable <div> element so a user can move a graph around anywhere on the screen -->
<div cdkDrag cdkDragRootElement=".cdk-overlay-pane">
  <!-- The draggable <div> element so a user can move a graph around anywhere on the screen, but only using the div header -->
  <div mat-dialog-title cdkDragHandle class="drag-header">
    <!-- Display the geoLayerView name along with data table when showing an attribute table -->
    <div class="header-div">
      <p class="header-title">
        {{geoLayerViewName}} - Data Table
      </p>
    </div>
    <!-- The close button on the upper right part of the dialog -->
    <button mat-button (click)="onClose()" class="upper-close-button">
      <i class="fa fa-times" aria-hidden="true"></i>
    </button>
  </div>
  <!------------------------------------------------------------------------------------------------------------------------------>
  <!-- Show the attribute table for a layer -->
  <div class="dialog-content">

    <mat-form-field>
      <mat-label>Filter</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Filter by substring in any column" #input>
    </mat-form-field>

    <cdk-virtual-scroll-viewport tvsItemSize bufferMultiplier="0.7" class="wrapper mat-elevation-z2">

      <table mat-table [dataSource]="attributeTable">
        <!-- Checkbox Column -->
        <ng-container matColumnDef="select" sticky>
          <th class="mat-table-select-header" mat-header-cell *matHeaderCellDef>
            <mat-checkbox class="check1"
                          (change)="$event ? masterToggle() : null"
                          [checked]="selection.hasValue() && isAllSelected()"
                          [indeterminate]="selection.hasValue() && !isAllSelected()"
                          [aria-label]="checkboxLabel()">
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox class="check2"
                          (click)="updateClickedRow($event, row)"
                          (change)="$event ? selection.toggle(row) : null"
                          [checked]="selection.isSelected(row)"
                          [aria-label]="checkboxLabel(row)">
            </mat-checkbox>
          </td>
        </ng-container>
        
        <!-- All Remaining Columns -->
        <ng-container *ngFor="let property of attributeTable.data[0].properties | keyvalue;" matColumnDef="{{property.key}}">
          <th class="mat-table-header" mat-header-cell *matHeaderCellDef>
            <b>
              {{property.key}}
            </b>
          </th>

          <td mat-cell
              *matCellDef="let element; let i = index"
              [ngClass]="element.properties[property.key] | justification"
              [attr.id]="'cell-' + element.properties[property.key]">

            {{element.properties[property.key]}}
            <!-- If the property value is a URL, it has already been truncated (as attributeTable is a copy), so below the
            truncated version of the link above, display Link to open up in a new tab. Using a pipe so computations are done
            only when they need to be. Adding 'true' bypasses the justification part of the pipe and only checks for a URL -->
            <div *ngIf="element.properties[property.key] | justification: 'true'">
                <a [attr.href]="links[element.properties[property.key]]" target="_blank">Link</a>
            </div>
            
          </td>
        </ng-container>
  
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        <!-- Show a row with text letting a user know that there input matches nothing in the dataset. This only works with
        Angular and Material version 10 -->
        <tr class="mat-row" *matNoDataRow>
          <td class="filter-not-found-cell" colspan="5">No data matching the filter "{{input.value}}"</td>
        </tr>
      </table>

    </cdk-virtual-scroll-viewport>

    <div class="table-info-components">
      <p class="table-rows-selected">{{attributeTableOriginal.length}} rows, {{matchedRows}} matched, {{selectedRows}} selected</p>

      <div class="table-buttons">
        <button mat-raised-button
                (click)="saveDataTable()"
                class="table-save-csv"
                matTooltip="Download layer data table as csv file"
                [matTooltipShowDelay]="250">
          Download
        </button>

        <button mat-raised-button (click)="onClose()" class="lower-data-table-close-button">
          Close
        </button>

        <button class="kebab-menu"
                mat-icon-button
                [matMenuTriggerFor]="menuFriend"
                matTooltip="Click to view layer menu options"
                [matTooltipShowDelay]="750">
          <mat-icon class="dots">more_vert</mat-icon>
        </button>
        <mat-menu #menuFriend="matMenu">
          <button mat-menu-item
                  (click)="zoomToFeatures()"
                  [disabled]="leafletData | zoomDisable: geoLayerId">
            <i class="fa fa-search-plus fa-2x"></i>
            Zoom to Feature(s)
          </button>
        </mat-menu>

      </div>
    </div>

  </div>
</div>
