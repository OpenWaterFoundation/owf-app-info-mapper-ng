<div id="map-container">

  <!-- Optionally define the sidebar content via HTML markup -->
  <div id="sidebar" class="leaflet-sidebar collapsed">

    <!-- Nav Tabs -->
    <div class="leaflet-sidebar-tabs">
      <!-- Top Aligned Tabs -->
      <ul role="tablist">
        <!-- Main menu button (Hamburger Icon) -->
        <li>
          <a href="#home"
              role="tab"
              matTooltip="Main tools"
              matTooltipShowDelay="750">
                <i class="fa fa-bars active"></i>
          </a>
        </li>
        <!-- Autopan button (4 directional arrows) -->
        <!-- <li><a matTooltip="Autopan tools" href="#autopan" role="tab"><i class="fa fa-arrows"></i></a></li> -->
        <!---Information Button (i)-->
        <!-- <li><a matTooltip="Help / About" href="#information" role="tab"><i class="fa fa-info-circle"></i></a></li> -->
      </ul>

      <!-- Bottom Aligned Tabs -->
      <!-- The Help / About anchor that opens up the appropriate portion of the side bar. The commented out line below is an
      example of another anchor that could be added -->
      <ul role="tablist">
        <li>
          <a href="#information"
              role="tab"
              matTooltip="Help / About"
              matTooltipShowDelay="750"
              matTooltipPosition="right">
            <i class="fa fa-info-circle"></i>
          </a>
        </li>
        <!-- <li><a matTooltip="External link to project on GitHub" href="https://github.com/nickpeihl/leaflet-sidebar-v2"><i class="fa fa-github"></i></a></li> -->
      </ul>

    </div>

    <!-- Panel content -->
    <div class="leaflet-sidebar-content">
      <div class="leaflet-sidebar-pane" id="home">
        <h1 class="leaflet-sidebar-header">
          <div *ngIf="mapService.getGeoMapName()" class="geoMap-title">{{mapService.getGeoMapName()}}</div>

          <div *ngIf="mapService.getMapConfig()">
            <div *ngIf="mapService.getMapConfig().geoMaps[0].properties.docPath" class="geoMap-doc-button">
              <button class="btn geoMap-info-circle"
                      (click)="showLayerDoc(mapService.getMapConfig().geoMaps[0].properties.docPath)"
                      routerLink="."
                      [queryParams]="{ dialog: true }"
                      matTooltip="Click to view map documentation"
                      [matTooltipShowDelay]="750">
                <i class="fa fa-info-circle fa-lg"></i>
              </button>
            </div>
          </div>
          
          <span matTooltip="Close sidebar"
                [matTooltipShowDelay]="750"
                class="leaflet-sidebar-close">
                  <i class="fa fa-caret-left"></i>
          </span>
          
        </h1>

        <br>

        <div class="accordion" id="sidebar-accordion">

          <div *ngIf="mapService.getMapConfig()">
            <div *ngFor="let geoLayerViewGroup of mapService.getMapConfig().geoMaps[0].geoLayerViewGroups">

              <div *ngIf="geoLayerViewGroup.properties.isBackground == undefined || geoLayerViewGroup.properties.isBackground == 'false'; else background">
                
                <div class="card">

                  <div *ngIf="geoLayerViewGroup.properties.docPath">
                    <div class="btn-group geoLayerViewGroupMain">

                      <button class="btn geoLayerViewGroupName"
                              data-toggle="collapse"
                              matTooltip="Click to expand/collapse layer controls"
                              matTooltipPosition="above"
                              [matTooltipShowDelay]="750"
                              [attr.aria-controls]='"collapse-" + geoLayerViewGroup.geoLayerViewGroupId'
                              [attr.data-target]='"#collapse-" + geoLayerViewGroup.geoLayerViewGroupId'
                              aria-expanded="true"
                              style="text-align: left; width: 100%;">
                        {{geoLayerViewGroup.name}}
                      </button>

                      <div class="geoLayerViewGroup-doc-button">
                        <button class="btn geoLayerViewGroup-info-circle"
                                (click)="showLayerDoc(geoLayerViewGroup.properties.docPath)"
                                routerLink="."
                                [queryParams]="{ dialog: true }"
                                matTooltip="Click to view layer group documentation"
                                [matTooltipShowDelay]="750">
                          <i class="fa fa-info-circle fa-lg"></i>
                        </button>
                      </div>

                      <button class="btn geoLayerViewGroupGear"
                              data-toggle="collapse" 
                              [attr.data-target]="'#collapse-map-controls' + geoLayerViewGroup.geoLayerViewGroupId"
                              aria-expanded="false"
                              matTooltip="Click to expand/collapse map controls"
                              [matTooltipShowDelay]="750">
                        <i class="fa fa-cog fa-lg" aria-hidden="true"></i>
                      </button>

                    </div>
                  </div>

                  <div *ngIf="!geoLayerViewGroup.properties.docPath">
                    <div class="geoLayerViewGroupMain">
                      <button class="btn geoLayerViewGroupName"
                              data-toggle="collapse"
                              [attr.aria-controls]='"collapse-" + geoLayerViewGroup.geoLayerViewGroupId'
                              [attr.data-target]='"#collapse-" + geoLayerViewGroup.geoLayerViewGroupId'
                              matTooltip="Click to expand/collapse layer controls"
                              [matTooltipShowDelay]="750"
                              aria-expanded="true"
                              style="text-align: left; width: 80%;">
                        {{geoLayerViewGroup.name}}
                      </button>
  
                      <button class="btn geoLayerViewGroupGear"
                              data-toggle="collapse" 
                              [attr.data-target]="'#collapse-map-controls' + geoLayerViewGroup.geoLayerViewGroupId"
                              matTooltip="Click to expand/collapse map controls"
                              [matTooltipShowDelay]="750"
                              aria-expanded="false"
                              style="width: 20%;">
                        <i class="fa fa-cog fa-lg" aria-hidden="true"></i>
                      </button>
  
                    </div>
                  </div>

                    <div [attr.id]="'collapse-map-controls' + geoLayerViewGroup.geoLayerViewGroupId"
                          class="collapse">
                      <div class="card-body">
                        <table class="layerOptions">
                          <p style="margin-bottom:5px; float: left"><b><u>Map Controls:</u></b></p><br><br>
                          <div id="toggleAll">
                            <div class="controlCol">
                              <button class="toggleAllButton"
                                      id="display-button"
                                      (click)="toggleAllLayers()"
                                      matTooltip="Click to show or hide all layers on the map"
                                      matTooltipPosition="right"
                                      [matTooltipShowDelay]="750">
                                Hide All Layers
                              </button>
                            </div>
                          </div>
        
                          <p style="margin-bottom:5px; float: left"><b><u>Legend Controls:</u></b></p><br><br>
                          <div id="toggleDescription">
                            <div id="controlDescription">
                              <input name="showDescriptions"
                                      type="checkbox"
                                      matTooltip="Show/hide the descriptions under the layer controls"
                                      matTooltipPosition="above"
                                      [matTooltipShowDelay]="750"
                                      (click)="toggleDescriptions()"> 
                                Hide All Descriptions
                            </div>
                          </div>
                          <div id="toggleDescription">
                            <div id="controlDescription">
                              <input name="showSymbols"
                                      type="checkbox"
                                      matTooltip="Show/hide the symbols under the layer controls"
                                      [matTooltipShowDelay]="750"
                                      (click)="toggleSymbols()"> 
                                Hide All Symbols
                            </div>
                          </div>
                        </table>
                      </div>
                    </div>

                  <div [attr.id]='"collapse-" + geoLayerViewGroup.geoLayerViewGroupId' class="collapse show" aria-labelledby="headingOne">

                    <div class="card-body">

                      <!-- Here go through each layerView and just show them. No need for trying to dynamically create
                      each one as a component. Just show each one of them here -->
                      <div *ngFor="let layerView of geoLayerViewGroup.geoLayerViews; let numOfViews = index">
                        
                        <div *ngIf="layerView.properties.docPath; else alone">
                          <div id="layer-title-friend">
                            {{layerView.name}}
                          </div>
  
                          <!-- If the geoLayerView contains the docPath property and it's not empty, display the information here -->
                          <div class="geoLayerView-doc-button">
                            <button class="btn geoLayerView-info-circle"
                                    (click)="showLayerDoc(layerView.properties.docPath)"
                                    routerLink="."
                                    [queryParams]="{ dialog: true }"
                                    matTooltip="Click to view layer documentation"
                                    matTooltipShowDelay="750">
                              <i class="fa fa-info-circle fa-lg"></i>
                            </button>
                          </div>

                          <div class="menu">

                            <button mat-icon-button [matMenuTriggerFor]="menuFriend">
                              <mat-icon>more_vert</mat-icon>
                            </button>
                            <mat-menu #menuFriend="matMenu">
                              <button mat-menu-item
                                      (click)="openAttributeTableDialog(layerView.geoLayerId)">
                                <mat-icon [ngStyle]="{'color':'black'}">grid_on</mat-icon>
                                <span>Attribute Table</span>
                              </button>
                            </mat-menu>

                          </div>
                      
                          <div class="switch-friend">
                            <label matTooltip="Show/hide this layer on the map"
                                    matTooltipShowDelay="750">
                              <input id="{{layerView.geoLayerId}}-slider" type="checkbox"
                                      (click)="toggleLayer(layerView.geoLayerId)" [attr.checked]="selectedInitial(layerView)">
                              <span class="slider round"></span>
                            </label>
                          </div>
  
                          <div class="description" id="description-{{layerView.geoLayerId}}">
                            {{layerView.description}}
                          </div>
                        </div>
                        
                        <ng-template #alone>

                          <div class="alone">
                            <div id="layer-title-alone">
                              {{layerView.name}}
                            </div>

                            <div class="menu">

                              <button mat-icon-button [matMenuTriggerFor]="menuAlone">
                                <mat-icon>more_vert</mat-icon>
                              </button>
                              <mat-menu #menuAlone="matMenu">
                                <button mat-menu-item
                                        (click)="openAttributeTableDialog(layerView.geoLayerId)">
                                  <mat-icon [ngStyle]="{'color':'black'}">grid_on</mat-icon>
                                  <span>Attribute Table</span>
                                </button>
                              </mat-menu>

                            </div>
                        
                            <div class="switch-alone">
                              <label matTooltip="Show/hide this layer on the map"
                                      matTooltipShowDelay="750">
                                <input id="{{layerView.geoLayerId}}-slider" type="checkbox"
                                        (click)="toggleLayer(layerView.geoLayerId)" [attr.checked]="selectedInitial(layerView)">
                                <span class="slider round"></span>
                              </label>
                            </div>
    
                            <div class="description-alone" id="description-{{layerView.geoLayerId}}">
                              {{layerView.description}}
                            </div>
                          </div>
                          
                        </ng-template>
                    
                        <br>
                    
                        <div class="symbols" id="symbols-{{layerView.geoLayerId}}">

                          <div>

                            <div>
                              <!-- SINGLE SYMBOL -->
                              <div *ngIf="layerView.geoLayerSymbol.classificationType.toUpperCase() === 'SINGLESYMBOL'">
                                <!-- LINE -->
                                <div *ngIf="this.getGeometryType(layerView.geoLayerId).toUpperCase().includes('LINESTRING')">
                                  <svg class="layer-icon" height="10" width="25">
                                    <line x1="5" y1="5" x2="25" y2="5" [ngStyle]="styleObject(layerView.geoLayerSymbol, 'ss')" style="stroke-width:2"/>
                                  </svg>
                                </div>
                                <!-- USER-PROVIDED DEFAULT MARKER -->
                                <div  *ngIf="layerView.geoLayerSymbol.properties.symbolImage">
                                  <img class="layer-icon"
                                        [attr.src]="this.appService.buildPath('symbolImage', [layerView.geoLayerSymbol.properties.symbolImage])">
                                </div>
                                <!-- BUILT-IN DEFAULT MARKER -->
                                <div *ngIf="layerView.geoLayerSymbol.properties.builtinSymbolImage">
                                  <img  class="layer-icon"
                                        [attr.src]="this.appService.buildPath('builtinSymbolImage', [layerView.geoLayerSymbol.properties.builtinSymbolImage])">
                                </div>
                                <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape; else defaultLegend">
                                  <!-- SQUARE -->
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'SQUARE'">
                                    <svg class="layer-icon" width="18" height="18">
                                      <rect width="17" height="17" [ngStyle]="styleObject(layerView.geoLayerSymbol, 'ss')"/>
                                    </svg>
                                  </div>
                                  <!-- TRIANGLE & TRIANGLE-UP -->
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'TRIANGLE' ||
                                  layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'TRIANGLE-UP'">
                                    <svg class="layer-icon" height="18" width="18">
                                      <polygon points="9,1 1,17 17,17" [ngStyle]="styleObject(layerView.geoLayerSymbol, 'ss')"/>
                                    </svg>
                                  </div>
                                  <!-- TRIANGLE-DOWN -->
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'TRIANGLE-DOWN'">
                                    <svg class="layer-icon" height="18" width="18">
                                      <polygon points="0,0 18,0, 9,18" [ngStyle]="styleObject(layerView.geoLayerSymbol, 'ss')"/>
                                    </svg>
                                  </div>
                                  <!-- DIAMOND -->
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'DIAMOND'">
                                    <svg class="layer-icon" height="18" width="18">
                                      <polygon points="0,9 9,18 18,9 9,0" [ngStyle]="styleObject(layerView.geoLayerSymbol, 'ss')"/>
                                    </svg>
                                  </div>
                                  <!-- CIRCLE -->
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'CIRCLE'">
                                    <svg class="layer-icon" height="20" width="20">
                                      <circle cx="10" cy="10" r="8" [ngStyle]="styleObject(layerView.geoLayerSymbol, 'ss')"/>
                                    </svg>
                                  </div>
                                  <!-- X -->
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'X'">
                                    <svg class="layer-icon" height="18" width="18">
                                      <line x1="0" y1="0" x2="18" y2="18"
                                            [ngStyle]="styleObject(layerView.geoLayerSymbol, 'ss')"
                                            style="stroke-width: 2;"/>
                                      <line x1="18" y1="0" x2="0" y2="18"
                                            [ngStyle]="styleObject(layerView.geoLayerSymbol, 'ss')"
                                            style="stroke-width: 2;"/>
                                    </svg>
                                  </div>
                                </div>
                                <ng-template #defaultLegend>
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolImage === undefined &&
                                  layerView.geoLayerSymbol.properties.builtinSymbolImage === undefined &&
                                  !this.getGeometryType(layerView.geoLayerId).toUpperCase().includes('LINESTRING')">
                                    <svg class="layer-icon" width="18" height="18">
                                      <rect width="17" height="17" [ngStyle]="styleObject(layerView.geoLayerSymbol, 'ss')"/>
                                    </svg>
                                  </div>
                                </ng-template>
                              </div>

                              <!-- CATEGORIZED -->
                              <div *ngIf="layerView.geoLayerSymbol.classificationType.toUpperCase() ===  'CATEGORIZED'">
                                <div *ngIf="categorizedLayerColor[layerView.geoLayerId]">
                                  <div *ngFor="let location of categorizedLayerColor[layerView.geoLayerId]; let i = index">
                                    <div *ngIf="(i % 2) === 0">
                                      <!-- SQUARE will be default for polygons -->
                                      <svg class="layer-icon" width="18" height="18">
                                        <rect width="18" height="18"
                                              [ngStyle]="{'fill': categorizedLayerColor[layerView.geoLayerId][i + 1]}" />
                                      </svg>
                                      {{location}}<br><br>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <!-- GRADUATED -->
                              <div *ngIf="layerView.geoLayerSymbol.classificationType.toUpperCase() === 'GRADUATED'">
                                <div *ngFor="let graduatedKeyName of graduatedKeyNames; let num = index">
                                  <b>Ordered by: {{graduatedClassificationField[num]}}</b>
                                  <!-- SQUARE -->
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape && layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'SQUARE'">
                                    <svg class='graduated' width="18" height="18">
                                      <rect width="18" height="18" [ngStyle]="{'fill':graduatedKeyColors[(num*3)]}" />
                                    </svg>
                                    <svg class='graduated' width="18" height="18">
                                      <rect width="18" height="18" [ngStyle]="{'fill':graduatedKeyColors[(num*3) + 1]}" />
                                    </svg>
                                    <svg class='graduated' width="18" height="18">
                                      <rect width="18" height="18" [ngStyle]="{'fill':graduatedKeyColors[(num*3) + 2]}" />
                                    </svg>
                                    {{graduatedKeyNames[num]}}<br><br>
                                  </div>
                                  <!-- TRIANGLE -->
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape && layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'TRIANGLE'">
                                    <svg class='graduated' height="18" width="18">
                                      <polygon points="9,1 1,17 17,17" [ngStyle]="{'fill':'#' + graduatedKeyColors[(num*3)]}" />
                                    </svg>
                                    <svg class='graduated' height="18" width="18">
                                      <polygon points="9,1 1,17 17,17" [ngStyle]="{'fill':'#' + graduatedKeyColors[(num*3) + 1]}" />
                                    </svg>
                                    <svg class='graduated' height="18" width="18">
                                      <polygon points="9,1 1,17 17,17" [ngStyle]="{'fill':'#' + graduatedKeyColors[(num*3) + 2]}" />
                                    </svg>
                                    {{graduatedKeyNames[num]}}<br><br>
                                  </div>
                                  <!-- CIRCLE -->
                                  <div *ngIf="layerView.geoLayerSymbol.properties.symbolShape && layerView.geoLayerSymbol.properties.symbolShape.toUpperCase() == 'CIRCLE'">
                                    <svg class='graduated' height="20" width="20">
                                      <circle cx="10" cy="10" r="8" [ngStyle]="{'fill':'#' + graduatedKeyColors[(num*3)]}" />
                                    </svg>
                                    <svg class='graduated' height="20" width="20">
                                      <circle cx="10" cy="10" r="8" [ngStyle]="{'fill':'#' + graduatedKeyColors[(num*3) + 1]}" />
                                    </svg>
                                    <svg class='graduated' height="20" width="20">
                                      <circle cx="10" cy="10" r="8" [ngStyle]="{'fill':'#' + graduatedKeyColors[(num*3) + 2]}" />
                                    </svg>
                                    {{graduatedKeyNames[num]}}<br><br>
                                  </div> 
                                </div>
                              </div>
                            </div>

                          </div>

                        </div>
                        <!-- Check if the layer is the only one, or the last one. If it isn't draw the divider so there can be
                        something separating two layers -->
                        <div *ngIf="numOfViews !== geoLayerViewGroup.geoLayerViews.length - 1">
                          <hr class="divider">
                        </div>

                      </div>

                    </div>
                  </div>
                </div>

              </div>

              <ng-template #background>
                
                <div class="card">
                  <div class="card-header" id="background-layers">
                    <h5 class="mb-0">
                      <button class="btn btn-link"
                              data-target="#collapse-background"
                              data-toggle="collapse"
                              matTooltip="Click to expand/collapse background layer controls"
                              matTooltipShowDelay="750"
                              matTooltipPosition="above"
                              aria-expanded="true"
                              aria-controls="collapseOne"
                              style="text-align: left; width: 100%;">
                        {{geoLayerViewGroup.name}}
                      </button>
                    </h5>
                  </div>

                  <div id="collapse-background" class="collapse show"
                        aria-labelledby="headingOne"
                        data-parent="#background-layers">
                    <div class="card-body">
                      <ng-template background-layer-hook></ng-template>
                    </div>
                  </div>
                </div>

              </ng-template>
              
            </div>
          </div>

        </div>

      </div>

      <!-- The side bar information to be displayed when an anchor tag is clicked -->
      <!-- This used to be for the autopan anchor tag -->
      <!-- <div class="leaflet-sidebar-pane" id="autopan">
        <h1 class="leaflet-sidebar-header">
          autopan
          <span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span>
        </h1>
        <p>
          <code>Leaflet.control.sidebar( autopan: true )</code>
          makes sure that the map center always stays visible.
        </p>
        <p>
          The autopan behavior is responsive as well.
          Try opening and closing the sidebar from this pane!
        </p>
      </div> -->

      <!-- The Help / About side bar  -->
      <div class="leaflet-sidebar-pane" id="information">
        <h1 class="leaflet-sidebar-header">
          Help / About
          <span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span>
        </h1>
        <ng-template side-panel-info-host></ng-template>
      </div>

    </div>
  </div>

  <!-- Create the Leaflet map here -->
  <div id="mapID"></div>

</div>
